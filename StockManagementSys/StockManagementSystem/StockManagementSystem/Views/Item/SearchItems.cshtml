@using StockManagementSystem.Models.Domain;

@{
    ViewData["Title"] = "SearchItems";

    IEnumerable<Company>? comps = ViewData["comps"] as IEnumerable<Company>;

}

<h1>SearchItems</h1>


<div class="container">

    <select class="form-select mt-2" id="companyId" onchange="populateItems()"
                asp-for="SelectedCompanyId">

        @foreach(var item in Model.Companies)
             {        
        <option asp-for="SelectedCompanyId"
            onchange="populateItems()"
             id="companyId" value="@item.Id"> @item.Name
        </option>
             } 
    </select>
    <label for="exampleFormControlInput1" style="display:inline;" class="form-label">Email address</label>

    <select class="form-select" id="itemId" style="display:inline;" aria-label="Default select example">
    </select>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<script>

    var itemname;
    var companyname;
    var quantity;
    var list = [];
    var i = 0;
    //var quantityToChange = document.getElementById('QuantityToChange').value;


    function CreateTable() {



        var formData = new FormData(document.querySelector('form'));

        // Get the value of the QuantityToChange input field.
        var quantityToChange = formData.get('QuantityToChange');

        var selectedItemId = $("#itemId").val();

        var arr = [selectedItemId, itemname, companyname, quantityToChange];

        list.push(arr);


        let j = i;
        const table = document.querySelector('table tbody');

        const newRow = document.createElement('tr');
        const serial = document.createElement('td');
        const itemName = document.createElement('td');
        const company = document.createElement('td');
        const quantity = document.createElement('td');
        serial.textContent = i;
        itemName.textContent = list[j][1];
        company.textContent = list[j][2];
        quantity.textContent = list[j][3];

        newRow.appendChild(serial);
        newRow.appendChild(itemName);
        newRow.appendChild(company);
        newRow.appendChild(quantity);

        table.appendChild(newRow);

        i++;

    }
    function populateItems() {
        var companyId = $("#companyId").val();
        // Get the selected option element.
        var selectedOption = document.querySelector('#companyId option:checked');

        // Get the text of the selected option element.
        var selectedItemName = selectedOption.textContent;

        // Assign the text of the selected option element to a JavaScript variable.
        companyname = selectedItemName;

        $.ajax({
            url: "/Item/GetCompanyById",
            data: { companyId: companyId },
            success: function (data) {
                $("#itemId").find('option:enabled').remove(); // Clear the options before appending new ones
                $("#itemId").append('<option value="">select item</option>');
                $(data).each(
                    function (key, value) {
                        $("#itemId").append('<option value="' + value.id + '">' + value.name + '</option>');
                    });
            }
        });
    }

    function updateItemDetails() {
        var selectedItemId = $("#itemId").val();

        // Log the selected item ID to the console
        console.log("Selected item ID:", selectedItemId);

        $.ajax({
            url: "/StockIn/UpdateItemDetails",
            data: { itemId: selectedItemId },
            success: function (data) {
                $('#quantity').empty();
                $('#reorderLevel').empty();

                var item = data;

                // Log the Item object to the console
                console.lo"Item: ishan", item);

        $("#SelectedItemQuantity").val(item.quantity);
        console.log("item quantity:", item.quantity);
        console.log("item reordr:", item.reOrderLevel);
        itemname = item.name;
        $("#reorderLevel").val(item.reOrderLevel);



    }
        });
    }

         // Call the populateItems() function before the updateItemDetails() function

</script>




